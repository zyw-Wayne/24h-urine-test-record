---
name: 24小时尿蛋白检测H5应用开发
overview: 开发一个完整的24小时尿蛋白检测记录H5应用，使用React + Ant Design Mobile构建，支持排尿记录、检测指标记录、历史查询、数据可视化、数据导出和备份恢复功能。
todos:
  - id: init-project
    content: 初始化React + TypeScript + Vite项目，配置开发环境和依赖
    status: completed
  - id: setup-db
    content: 设计并实现IndexedDB数据库结构，使用Dexie.js封装数据操作
    status: completed
    dependencies:
      - init-project
  - id: layout-tabs
    content: 实现底部Tab导航布局（记录、历史、我的三个Tab）
    status: completed
    dependencies:
      - init-project
  - id: record-module
    content: 开发记录模块：检测周期管理、排尿记录、检测指标录入、实时统计
    status: completed
    dependencies:
      - setup-db
      - layout-tabs
  - id: history-module
    content: 开发历史模块：历史记录列表、详情页、数据可视化图表
    status: completed
    dependencies:
      - setup-db
      - layout-tabs
  - id: profile-module
    content: 开发我的模块：个人信息、数据导出、备份恢复、设置
    status: completed
    dependencies:
      - setup-db
      - layout-tabs
  - id: ui-polish
    content: UI优化和交互完善，确保符合Ant Design Mobile设计规范
    status: completed
    dependencies:
      - record-module
      - history-module
      - profile-module
  - id: testing
    content: 功能测试、兼容性测试和性能优化
    status: completed
    dependencies:
      - ui-polish
  - id: docs-deploy
    content: 编写文档和准备部署配置
    status: completed
    dependencies:
      - testing
---

# 24小时尿蛋白检测记录H5应用 - 开发计划

## 一、项目概述

### 1.1 项目背景

24小时尿蛋白检测是评估肾脏功能的重要检查方法。通过收集患者24小时内的全部尿液，测定其中的蛋白质含量，以判断肾小球滤过功能和肾小管重吸收功能是否正常。

### 1.2 项目目标

开发一款H5应用，帮助用户规范记录24小时尿蛋白检测过程中的各项数据，包括：

- 每次排尿的时间和尿量记录
- 检测指标记录（尿蛋白、肌酐、尿比重、pH值等）
- 历史记录查询和数据可视化
- 数据导出和备份恢复

### 1.3 目标用户

需要进行24小时尿蛋白检测的患者及其家属

## 二、功能需求（PRD）

### 2.1 核心功能模块

#### 2.1.1 记录模块（Tab 1）

**功能描述：** 记录当前检测周期的排尿数据和检测指标

**详细功能：**

1. **检测周期管理**

   - 开始新的24小时检测周期
   - 显示当前周期开始时间和剩余时间
   - 结束当前检测周期
   - 显示周期状态（进行中/已完成）

2. **排尿记录**

   - 记录每次排尿时间（自动获取当前时间，可手动调整）
   - 记录每次排尿量（毫升）
   - 显示已记录次数
   - 实时计算并显示累计总尿量
   - 支持编辑和删除已记录项

3. **检测指标记录**

   - 记录尿蛋白（mg/L 或 g/24h）
   - 记录肌酐（μmol/L）
   - 记录尿比重
   - 记录pH值
   - 自动计算24小时总尿蛋白量（尿蛋白浓度 × 总尿量）
   - 显示正常值范围参考（尿蛋白 < 150mg/24h）
   - 异常值提示（超出正常范围时高亮显示）

4. **数据统计卡片**

   - 总排尿次数
   - 总尿量（毫升）
   - 平均每次尿量
   - 24小时尿蛋白总量
   - 检测完成度（进度条）

#### 2.1.2 历史模块（Tab 2）

**功能描述：** 查看历史检测记录和数据分析

**详细功能：**

1. **历史记录列表**

   - 按时间倒序显示所有检测周期
   - 每个周期显示：开始时间、总尿量、尿蛋白总量、状态
   - 支持点击查看详情
   - 支持删除记录（带确认提示）

2. **记录详情页**

   - 显示周期完整信息
   - 显示所有排尿记录列表
   - 显示所有检测指标
   - 显示统计信息
   - 支持编辑和删除

3. **数据可视化**

   - 尿量趋势图（折线图/柱状图）
   - 尿蛋白趋势图
   - 肌酐趋势图
   - 多指标对比图（可选）
   - 支持时间范围筛选（最近7天/30天/全部）
   - 图表支持缩放和交互

#### 2.1.3 我的模块（Tab 3）

**功能描述：** 用户设置和数据管理

**详细功能：**

1. **个人信息**

   - 用户昵称设置
   - 性别、年龄（可选）
   - 备注信息

2. **数据管理**

   - 数据导出（Excel格式）
   - 数据备份（JSON格式下载）
   - 数据恢复（从备份文件导入）
   - 清空所有数据（带二次确认）

3. **设置**

   - 单位设置（毫升/升，mg/g等）
   - 主题设置（浅色/深色）
   - 关于页面

4. **使用说明**

   - 检测流程说明
   - 注意事项
   - 正常值参考

### 2.2 非功能性需求

1. **性能要求**

   - 页面加载时间 < 2秒
   - 数据操作响应时间 < 500ms
   - 支持至少1000条历史记录

2. **兼容性要求**

   - 支持iOS Safari 12+
   - 支持Android Chrome 80+
   - 支持微信内置浏览器
   - 响应式设计，适配各种屏幕尺寸

3. **数据安全**

   - 所有数据存储在本地，不上传服务器
   - 备份文件加密（可选）
   - 删除操作需二次确认

4. **用户体验**

   - 界面简洁直观，符合医疗应用规范
   - 操作流程清晰，减少用户学习成本
   - 提供操作反馈（成功/失败提示）
   - 支持离线使用

## 三、技术方案

### 3.1 技术栈

**前端框架：**

- React 18+ (使用函数组件和Hooks)
- TypeScript (类型安全)
- React Router (路由管理)

**UI框架：**

- Ant Design Mobile (移动端UI组件库)
- 自定义样式补充

**数据存储：**

- IndexedDB (使用Dexie.js库简化操作)
- LocalStorage (存储用户配置)

**数据可视化：**

- Chart.js (图表库)
- react-chartjs-2 (React封装)

**工具库：**

- dayjs (日期处理)
- xlsx (Excel导出)
- file-saver (文件下载)

**构建工具：**

- Vite (快速构建工具)
- ESLint + Prettier (代码规范)

### 3.2 项目结构

```
24h-urine-test-record/
├── public/                 # 静态资源
├── src/
│   ├── assets/            # 资源文件
│   ├── components/        # 公共组件
│   │   ├── Layout/        # 布局组件
│   │   ├── Charts/        # 图表组件
│   │   └── Common/        # 通用组件
│   ├── pages/             # 页面组件
│   │   ├── Record/        # 记录页
│   │   ├── History/       # 历史页
│   │   └── Profile/        # 我的页
│   ├── services/          # 服务层
│   │   ├── db.ts          # IndexedDB操作
│   │   ├── export.ts      # 数据导出
│   │   └── backup.ts      # 备份恢复
│   ├── hooks/             # 自定义Hooks
│   ├── utils/             # 工具函数
│   ├── types/             # TypeScript类型定义
│   ├── constants/         # 常量定义
│   ├── App.tsx            # 根组件
│   └── main.tsx           # 入口文件
├── package.json
├── tsconfig.json
├── vite.config.ts
└── README.md
```

### 3.3 数据模型设计

**检测周期 (TestCycle)**

```typescript
interface TestCycle {
  id: string;                    // 唯一ID
  startTime: string;             // 开始时间
  endTime?: string;              // 结束时间
  status: 'ongoing' | 'completed'; // 状态
  totalVolume: number;           // 总尿量(ml)
  urinationRecords: UrinationRecord[]; // 排尿记录
  testResults: TestResult;       // 检测结果
  createdAt: string;              // 创建时间
  updatedAt: string;              // 更新时间
}
```

**排尿记录 (UrinationRecord)**

```typescript
interface UrinationRecord {
  id: string;
  cycleId: string;
  time: string;                  // 排尿时间
  volume: number;                // 尿量(ml)
  createdAt: string;
}
```

**检测结果 (TestResult)**

```typescript
interface TestResult {
  protein: number;               // 尿蛋白(mg/L)
  proteinTotal24h?: number;      // 24h总蛋白(g)
  creatinine: number;            // 肌酐(μmol/L)
  specificGravity: number;       // 尿比重
  ph: number;                    // pH值
  testedAt: string;              // 检测时间
}
```

**用户配置 (UserConfig)**

```typescript
interface UserConfig {
  nickname: string;
  gender?: 'male' | 'female';
  age?: number;
  unit: {
    volume: 'ml' | 'l';
    protein: 'mg' | 'g';
  };
  theme: 'light' | 'dark';
}
```

## 四、开发计划

### 阶段一：项目初始化 (1-2天)

1. 初始化React + TypeScript + Vite项目
2. 配置ESLint、Prettier
3. 安装依赖（Ant Design Mobile、Chart.js、Dexie等）
4. 配置路由和基础布局
5. 设置IndexedDB数据库结构

### 阶段二：核心功能开发 (5-7天)

1. **记录模块开发**

   - 检测周期管理（开始/结束）
   - 排尿记录CRUD
   - 检测指标录入
   - 实时统计计算
   - 数据验证和异常提示

2. **历史模块开发**

   - 历史记录列表
   - 记录详情页
   - 数据可视化（Chart.js集成）
   - 时间筛选功能

3. **我的模块开发**

   - 个人信息设置
   - 数据导出（Excel）
   - 数据备份/恢复
   - 设置页面

### 阶段三：UI优化和交互完善 (2-3天)

1. 完善UI样式，确保符合Ant Design Mobile规范
2. 添加加载状态和错误处理
3. 优化移动端交互体验
4. 添加操作反馈提示

### 阶段四：测试和优化 (2-3天)

1. 功能测试（各模块功能完整性）
2. 兼容性测试（不同浏览器和设备）
3. 性能优化（数据量大时的处理）
4. 用户体验优化

### 阶段五：文档和部署准备 (1-2天)

1. 编写使用说明文档
2. 准备部署配置
3. 最终检查和修复

## 五、关键实现细节

### 5.1 IndexedDB数据库设计

使用Dexie.js简化IndexedDB操作，创建以下表：

- testCycles: 检测周期表
- urinationRecords: 排尿记录表
- userConfig: 用户配置表

### 5.2 数据导出功能

- Excel导出：使用xlsx库生成Excel文件，包含所有历史记录
- 备份导出：JSON格式，包含所有数据和配置

### 5.3 图表展示

使用Chart.js实现：

- 折线图：显示尿量、尿蛋白等指标的趋势
- 柱状图：显示不同周期的对比
- 支持时间范围筛选和交互

### 5.4 响应式设计

- 使用Ant Design Mobile的响应式组件
- 适配不同屏幕尺寸（手机、平板）
- 优化触摸交互体验

## 六、风险评估

1. **数据丢失风险**：通过备份恢复功能降低风险
2. **浏览器兼容性**：IndexedDB在某些旧浏览器可能不支持，需要降级方案
3. **数据量增长**：当历史记录过多时可能影响性能，需要分页或虚拟滚动

## 七、后续扩展（可选）

1. 数据云端同步（需要后端支持）
2. 多语言支持
3. 打印报告功能
4. 与医院系统对接
5. 数据分析报告生成