# 24小时尿蛋白检测记录系统 - 产品需求文档（PRD）

## 1. 项目概述

### 1.1 项目背景

24小时尿蛋白检测是临床上常用的肾功能检查方法，需要患者连续24小时收集所有尿液，并记录每次排尿的时间和尿量，最后进行实验室检测。传统的记录方式（纸质记录或简单备忘录）存在以下问题：

1. **记录不便**：需要随身携带纸笔，容易遗漏或丢失
2. **计算繁琐**：需要手动计算总尿量，容易出错
3. **数据管理困难**：历史记录难以保存和查询，无法追踪趋势
4. **缺乏提醒**：容易忘记记录或错过检测时间
5. **数据分享不便**：医生查看数据需要手动整理

### 1.2 项目目标

开发一个移动端H5应用，帮助用户：

1. **便捷记录**：随时随地记录排尿时间和尿量，自动计算总尿量
2. **智能提醒**：实时显示剩余时间，提醒用户及时记录
3. **数据管理**：完整保存历史记录，支持查询、导出和备份
4. **趋势分析**：通过图表展示检测指标的变化趋势
5. **隐私保护**：所有数据存储在本地，不上传服务器

### 1.3 目标用户

- **主要用户**：需要进行24小时尿蛋白检测的患者
- **次要用户**：医生（通过Excel导出查看数据）

### 1.4 使用场景

1. **检测期间**：用户在家中或工作场所，每次排尿后打开应用记录
2. **检测结束**：用户录入检测结果，查看统计信息
3. **复诊前**：用户查看历史记录，导出Excel给医生
4. **长期追踪**：用户定期查看数据趋势，了解病情变化

## 2. 功能需求

### 2.1 检测周期管理

#### 2.1.1 开始检测周期

**功能描述**：用户点击"开始检测周期"按钮，系统创建新的24小时检测周期。

**业务规则**：
- 同一时间只能有一个进行中的检测周期（status='ongoing'）
- 开始新周期前需要检查上一个周期：
  - 如果上一个周期已录入检测结果：提示确认后开始新周期
  - 如果上一个周期未录入检测结果：提示先录入检测结果，或选择跳过（需二次确认）
- 首次使用或没有历史周期时，直接开始新周期

**输入**：无（自动使用当前时间）

**输出**：
- 创建新的检测周期记录
- 显示周期信息卡片（开始时间、剩余时间、进度条）
- 提示"检测周期已开始"

**异常处理**：
- 如果当前有进行中的周期，提示"当前检测周期还在进行中，请先结束当前周期后再开始新周期"

#### 2.1.2 结束检测周期

**功能描述**：用户点击"结束检测周期"按钮，手动结束当前周期。

**业务规则**：
- 只有进行中的周期可以结束
- 结束周期后，不能再添加或删除排尿记录
- 结束周期后，仍可录入或编辑检测结果
- 需要确认操作（防止误操作）

**输入**：用户确认

**输出**：
- 更新周期状态为'completed'
- 记录结束时间
- 提示"检测周期已结束，您仍可录入检测结果"

**异常处理**：
- 如果周期已结束，不显示结束按钮

#### 2.1.3 实时倒计时显示

**功能描述**：在检测周期进行中，实时显示剩余时间。

**业务规则**：
- 每秒更新一次剩余时间（小时、分钟、秒）
- 显示进度条（已过时间 / 24小时 × 100%）
- 如果时间已到，显示0小时0分钟0秒

**输入**：周期开始时间

**输出**：实时更新的剩余时间和进度条

### 2.2 排尿记录管理

#### 2.2.1 添加排尿记录

**功能描述**：用户记录每次排尿的时间和尿量。

**业务规则**：
- 只有进行中的周期可以添加记录
- 排尿时间默认为当前时间，可手动调整
- 尿量必须大于0（ml）
- 添加记录后自动更新周期的总尿量
- 记录按时间排序显示

**输入**：
- 排尿时间（Date，默认当前时间）
- 尿量（number，ml，>0）

**输出**：
- 创建排尿记录
- 更新周期总尿量
- 刷新记录列表
- 提示"排尿记录已添加"

**异常处理**：
- 如果周期已结束，提示"检测周期已结束，无法添加排尿记录"
- 如果尿量≤0，表单验证失败
- 验证规则：
  - 排尿时间：必填，Date类型
  - 尿量：必填，>0，数字格式（支持小数）

#### 2.2.2 删除排尿记录

**功能描述**：用户删除已添加的排尿记录。

**业务规则**：
- 只有进行中的周期可以删除记录
- 删除记录后自动重新计算周期的总尿量
- 需要确认操作（防止误操作）

**输入**：记录ID

**输出**：
- 删除记录
- 更新周期总尿量
- 刷新记录列表
- 提示"记录已删除"

**异常处理**：
- 如果周期已结束，提示"检测周期已结束，无法删除排尿记录"

#### 2.2.3 查看排尿记录列表

**功能描述**：显示当前周期的所有排尿记录。

**业务规则**：
- 记录按时间升序排列
- 显示每次记录的尿量和时间
- 显示总排尿次数和总尿量
- 显示平均每次尿量

**输入**：周期ID

**输出**：排尿记录列表（时间、尿量）

### 2.3 检测结果录入

#### 2.3.1 录入检测结果

**功能描述**：用户录入实验室检测的各项指标。

**业务规则**：
- 可以在周期进行中或结束后录入
- 必填项：24H尿蛋白定量、肌酐、尿比重、pH值
- 可选项：尿常规-尿蛋白、尿常规-潜血
- 自动计算24小时总尿蛋白量
- 支持编辑已录入的结果

**输入**：
- 24H尿蛋白定量（number，mg/L，≥0，必填）
- 尿常规-尿蛋白（string，可选：阴性(-)、弱阳性(±)、1+、2+、3+、4+、++、+++、++++）
- 尿常规-潜血（string，可选：同上）
- 肌酐（number，μmol/L，≥0，必填）
- 尿比重（number，1.000-1.050，必填）
- pH值（number，0-14，必填）

**输出**：
- 保存检测结果
- 自动计算24小时总尿蛋白量
- 显示检测结果卡片（含异常值高亮）
- 提示"检测结果已保存"

**计算公式**：
```
24小时总尿蛋白量(g) = (24H尿蛋白定量(mg/L) × 总尿量(ml)) / 1000 / 1000
```

**异常处理**：
- 表单验证失败时显示相应错误提示
- 数值超出范围时提示错误
- 验证规则：
  - 24H尿蛋白定量：必填，≥0，数字格式
  - 肌酐：必填，≥0，数字格式
  - 尿比重：必填，1.000-1.050，数字格式，步长0.001
  - pH值：必填，0-14，数字格式，步长0.1
  - 尿常规-尿蛋白/潜血：可选，从预设选项中选择

#### 2.3.2 异常值判断和提示

**功能描述**：根据正常值范围判断检测结果是否异常，并高亮显示。

**业务规则**：
- 根据用户设置的性别判断肌酐正常值范围：
  - 男性：53-106 μmol/L
  - 女性：44-97 μmol/L（默认，更保守）
- 其他指标正常值范围（男女通用）：
  - 24小时尿蛋白：< 150 mg
  - 尿比重：1.003-1.030
  - pH值：4.6-8.0
- 超出正常范围的指标以红色高亮显示

**输入**：检测结果值、用户性别

**输出**：异常值红色高亮显示

### 2.4 历史记录查询

#### 2.4.1 历史记录列表

**功能描述**：显示所有历史检测记录。

**业务规则**：
- 记录按创建时间倒序排列（最新的在前）
- 显示周期基本信息：开始时间、总尿量、排尿次数、24h总蛋白、状态
- 支持时间筛选：最近3个月、最近6个月、全部
- 点击记录可查看详情

**输入**：时间筛选条件（可选）

**输出**：历史记录列表

#### 2.4.2 记录详情查看

**功能描述**：查看单个检测周期的完整信息。

**业务规则**：
- 显示周期信息：开始时间、结束时间、状态、总尿量、排尿次数
- 显示检测结果：所有检测指标（含异常值高亮）
- 显示所有排尿记录：按时间排序，显示序号、时间、尿量
- 支持删除排尿记录（仅限进行中的周期）

**输入**：周期ID

**输出**：周期详情（弹窗形式）

#### 2.4.3 删除历史记录

**功能描述**：删除单条历史记录。

**业务规则**：
- 需要确认操作（防止误操作）
- 删除周期时同时删除相关的所有排尿记录
- 删除后刷新列表

**输入**：周期ID、用户确认

**输出**：
- 删除周期和所有相关记录
- 刷新列表
- 提示"删除成功"

### 2.5 数据可视化

#### 2.5.1 图表展示

**功能描述**：通过图表展示多个检测指标的趋势变化。

**业务规则**：
- 支持多个图表类型：
  - 折线图：24H尿蛋白定量趋势、肌酐趋势
  - 柱状图：尿常规-尿蛋白趋势、尿常规-潜血趋势、多指标对比
- 图表数据按时间升序排列
- 支持时间筛选（最近3个月/6个月/全部）
- 尿常规值转换为数值用于图表显示：
  - 阴性(-) = 0
  - 弱阳性(±) = 0.5
  - 1+/++ = 1
  - 2+/+++ = 2
  - 3+/++++ = 3
  - 4+ = 4

**输入**：历史记录数据、时间筛选条件

**输出**：多个图表（弹窗形式）

**图表类型**：
1. 24H尿蛋白定量趋势（折线图）
2. 尿常规-尿蛋白趋势（柱状图）
3. 尿常规-潜血趋势（柱状图）
4. 肌酐趋势（折线图）
5. 多指标对比（柱状图，包含总尿量、24h总蛋白、24H尿蛋白定量、肌酐）

### 2.6 数据管理

#### 2.6.1 Excel导出

**功能描述**：导出所有历史记录为Excel文件。

**业务规则**：
- 导出所有检测周期（不受时间筛选影响）
- 包含周期基本信息、检测结果、所有排尿记录
- 文件名格式：`24小时尿蛋白检测记录_YYYY-MM-DD_HH-mm-ss.xlsx`
- 设置合适的列宽，方便查看

**输入**：所有历史记录

**输出**：Excel文件（下载）

**Excel结构**：
- 每行一个周期或一条排尿记录
- 周期行包含：周期ID、开始时间、结束时间、状态、总尿量、所有检测指标、排尿次数
- 排尿记录行包含：周期ID（空）、排尿时间、尿量

#### 2.6.2 数据备份

**功能描述**：备份所有数据为JSON文件。

**业务规则**：
- 备份所有检测周期（包含完整数据）
- 备份用户配置
- 包含备份版本号和导出时间
- 文件名格式：`24h_urine_test_backup_YYYY-MM-DD_HH-mm-ss.json`

**输入**：所有数据

**输出**：JSON文件（下载）

**JSON结构**：
```json
{
  "version": "1.0.0",
  "exportTime": "2024-01-01T00:00:00.000Z",
  "testCycles": [...],
  "userConfig": {...}
}
```

#### 2.6.3 数据恢复

**功能描述**：从备份文件恢复数据。

**业务规则**：
- 验证备份文件格式（版本号、数据结构）
- 恢复前清空现有数据
- 恢复所有检测周期和排尿记录（保留原始ID和时间戳）
- 恢复用户配置
- 重新计算总尿量

**输入**：备份JSON文件

**输出**：
- 恢复所有数据
- 提示"恢复成功"

**异常处理**：
- 如果文件格式不正确，提示"备份文件格式不正确"
- 如果读取文件失败，提示"读取文件失败"

#### 2.6.4 数据清空

**功能描述**：清空所有数据。

**业务规则**：
- 需要二次确认（防止误操作）
- 清空前提示用户先备份数据
- 清空所有检测周期、排尿记录和用户配置

**输入**：用户二次确认

**输出**：
- 清空所有数据
- 提示"数据已清空"

### 2.7 用户设置

#### 2.7.1 个人信息设置

**功能描述**：设置用户个人信息。

**业务规则**：
- 昵称：必填
- 性别：可选（'male' | 'female'），用于判断肌酐正常值范围
- 年龄：可选（数字）

**输入**：
- 昵称（string，必填）
- 性别（'male' | 'female'，可选）
- 年龄（number，可选）

**输出**：
- 保存用户配置
- 更新显示
- 提示"保存成功"

#### 2.7.2 单位设置

**功能描述**：设置显示单位。

**业务规则**：
- 尿量单位：ml（毫升）或 L（升），默认ml
- 蛋白单位：mg（毫克）或 g（克），默认mg

**输入**：
- 尿量单位（'ml' | 'l'）
- 蛋白单位（'mg' | 'g'）

**输出**：
- 保存单位设置
- 更新显示

#### 2.7.3 主题设置

**功能描述**：设置应用主题。

**业务规则**：
- 支持浅色主题（'light'）和深色主题（'dark'）
- 默认浅色主题

**输入**：主题（'light' | 'dark'）

**输出**：
- 保存主题设置
- 更新UI显示

#### 2.7.4 使用说明

**功能描述**：显示检测流程、注意事项和正常值参考。

**业务规则**：
- 内置说明内容，不可编辑
- 包含：检测流程、注意事项、正常值参考

**内容**：
- **检测流程**：
  1. 点击"开始检测周期"开始24小时检测
  2. 每次排尿后记录时间和尿量
  3. 24小时后结束检测周期
  4. 录入检测指标（尿蛋白、肌酐、尿比重、pH值）
- **注意事项**：
  - 首次排尿不收集，之后的所有尿液都需收集
  - 尿液需冷藏保存，避免细菌污染
  - 避免剧烈运动、高蛋白饮食
  - 确保尿液收集完整，避免遗漏
- **正常值参考**：
  - 24小时尿蛋白: < 150 mg（男女通用）
  - 肌酐: 男性 53-106 μmol/L，女性 44-97 μmol/L
  - 尿比重: 1.003-1.030（男女通用）
  - pH值: 4.6-8.0（男女通用）

## 3. 非功能需求

### 3.1 性能需求

1. **响应时间**：
   - 页面加载时间 < 2秒
   - 数据操作响应时间 < 500ms
   - 图表渲染时间 < 1秒

2. **数据容量**：
   - 支持存储至少1000条检测周期记录
   - 支持单次导出至少100条记录到Excel

3. **并发处理**：
   - 支持单用户使用（无需考虑并发）

### 3.2 可用性需求

1. **易用性**：
   - 界面简洁直观，操作流程清晰
   - 关键操作有确认提示，防止误操作
   - 提供使用说明和帮助信息

2. **可访问性**：
   - 支持移动端浏览器（iOS Safari、Android Chrome、微信内置浏览器）
   - 适配不同屏幕尺寸（响应式设计）

3. **错误处理**：
   - 所有操作都有明确的成功/失败提示（Toast）
   - 表单验证错误有清晰的提示信息（实时反馈）
   - 使用ErrorBoundary捕获React组件错误，显示友好错误页面和重试按钮
   - 所有异步操作都有try-catch错误处理
   - 错误信息记录到控制台，便于调试

### 3.3 安全性需求

1. **数据隐私**：
   - 所有数据存储在本地浏览器（IndexedDB），不上传服务器
   - 用户数据完全由用户控制

2. **数据完整性**：
   - 数据操作使用事务保证一致性
   - 备份恢复时验证数据格式

3. **输入验证**：
   - 所有用户输入都进行验证
   - 防止SQL注入（使用Dexie.js，自动防护）
   - 防止XSS攻击（React自动转义）

### 3.4 兼容性需求

1. **浏览器兼容**：
   - iOS Safari 12+
   - Android Chrome 80+
   - 微信内置浏览器
   - 其他现代浏览器（支持ES6+和IndexedDB）

2. **设备兼容**：
   - 支持iOS和Android设备
   - 支持不同屏幕尺寸（手机、平板）
   - 支持iPhone X等带安全区域的设备（CSS env()函数）
   - 防止移动端双击缩放（touch-action: manipulation）
   - 优化输入框字体大小（16px，防止iOS自动缩放）
   - 优化点击区域（最小44px×44px）

### 3.5 可维护性需求

1. **代码质量**：
   - 使用TypeScript确保类型安全
   - 遵循ESLint和Prettier代码规范
   - 所有AI生成的代码都标记注释

2. **代码结构**：
   - 清晰的目录结构
   - 服务层分离（数据操作、导出、备份）
   - 组件化设计，便于复用

3. **文档**：
   - 完善的README文档
   - 详细的PRD文档
   - 代码注释清晰

## 4. 技术方案

### 4.1 技术选型

#### 4.1.1 前端框架

- **React 18.3.1**：使用函数组件和Hooks，提供良好的开发体验
- **TypeScript 5.5.4**：类型安全，提高代码质量和可维护性

#### 4.1.2 UI框架

- **Ant Design Mobile 5.37.0**：移动端UI组件库，提供丰富的组件和良好的移动端体验

#### 4.1.3 数据存储

- **IndexedDB**：浏览器本地数据库，支持大量数据存储
- **Dexie.js 3.2.4**：IndexedDB的封装库，提供简洁的API和类型支持

#### 4.1.4 数据可视化

- **Chart.js 4.4.4**：强大的图表库，支持多种图表类型
- **react-chartjs-2 5.2.0**：Chart.js的React封装

#### 4.1.5 工具库

- **dayjs 1.11.13**：轻量级日期处理库
- **xlsx 0.18.5**：Excel文件生成库
- **file-saver 2.0.5**：文件下载库

#### 4.1.6 构建工具

- **Vite 5.4.2**：快速的前端构建工具，提供良好的开发体验

#### 4.1.7 路由管理

- **React Router 6.26.0**：单页应用路由管理

### 4.2 架构设计

#### 4.2.1 路由设计

- **根路径（/）**：重定向到 `/record`
- **记录页（/record）**：检测周期管理和记录录入
- **历史页（/history）**：历史记录查询和数据可视化
- **我的页（/profile）**：用户设置和数据管理

路由使用React Router 6.x，支持浏览器前进/后退导航。

#### 4.2.2 目录结构

```
src/
├── components/          # 公共组件
│   ├── Layout/         # 布局组件（底部导航栏）
│   └── Common/         # 通用组件（EmptyState、ErrorBoundary、Loading）
├── pages/              # 页面组件
│   ├── Record/         # 记录页（检测周期管理、记录录入）
│   ├── History/        # 历史页（历史记录列表、详情、图表）
│   └── Profile/        # 我的页（用户设置、数据管理）
├── services/           # 服务层
│   ├── db.ts          # IndexedDB数据库操作
│   ├── export.ts      # Excel导出功能
│   └── backup.ts      # 数据备份和恢复
├── utils/              # 工具函数
│   ├── index.ts       # 通用工具函数
│   └── normalRanges.ts # 正常值范围计算
├── types/              # TypeScript类型定义
│   └── index.ts       # 所有类型定义
├── constants/          # 常量定义
│   └── index.ts       # 应用常量
├── App.tsx            # 根组件（路由配置）
├── main.tsx           # 入口文件
└── index.css          # 全局样式
```

#### 4.2.2 数据流设计

1. **数据存储层**（IndexedDB）：
   - 使用Dexie.js封装数据库操作
   - 提供类型安全的API

2. **服务层**（services/）：
   - `db.ts`：数据库CRUD操作
   - `export.ts`：Excel导出逻辑
   - `backup.ts`：数据备份和恢复逻辑

3. **页面层**（pages/）：
   - 调用服务层API获取和操作数据
   - 处理用户交互和UI展示

4. **组件层**（components/）：
   - 可复用的UI组件（EmptyState、Loading、ErrorBoundary）
   - 布局组件（底部导航栏Layout）

#### 4.2.3 状态管理

- 使用React Hooks（useState、useEffect）进行本地状态管理
- 数据持久化通过IndexedDB，页面刷新后数据不丢失
- 组件间数据共享通过服务层API，不依赖全局状态管理

### 4.3 数据模型设计

#### 4.3.1 数据库设计

**数据库名称**：`UrineTestDB`  
**版本**：1

**表结构**：

1. **testCycles（检测周期表）**
   - 索引：id（主键）、startTime、status、createdAt
   - 字段：见数据模型章节

2. **urinationRecords（排尿记录表）**
   - 索引：id（主键）、cycleId（外键）、time、createdAt
   - 字段：见数据模型章节

3. **userConfig（用户配置表）**
   - 索引：id（主键，固定为'default'）
   - 字段：见数据模型章节

#### 4.3.2 数据关系

- 一个检测周期（TestCycle）可以有多个排尿记录（UrinationRecord）
- 一个检测周期（TestCycle）可以有零个或一个检测结果（TestResult）
- 用户配置（UserConfig）是单例（只有一个记录）

### 4.4 核心算法

#### 4.4.1 24小时总尿蛋白量计算

```typescript
function calculateProteinTotal24h(protein: number, totalVolume: number): number {
  // 尿蛋白浓度(mg/L) * 总尿量(ml) / 1000 / 1000 = 总蛋白(g)
  return (protein * totalVolume) / 1000 / 1000
}
```

#### 4.4.2 剩余时间计算

```typescript
function getRemainingTime(startTime: string): { hours: number; minutes: number; seconds: number } {
  const start = dayjs(startTime)
  const end = start.add(24, 'hour')
  const now = dayjs()
  const diff = end.diff(now, 'second')
  
  if (diff <= 0) {
    return { hours: 0, minutes: 0, seconds: 0 }
  }
  
  const hours = Math.floor(diff / 3600)
  const minutes = Math.floor((diff % 3600) / 60)
  const seconds = diff % 60
  
  return { hours, minutes, seconds }
}
```

#### 4.4.3 异常值判断

```typescript
function isAbnormal(value: number, min: number, max: number): boolean {
  return value < min || value > max
}

// 根据用户性别获取肌酐正常值范围
function getCreatinineRange(gender?: 'male' | 'female') {
  if (gender === 'male') {
    return { min: 53, max: 106 }
  }
  return { min: 44, max: 97 } // 女性（默认）
}
```

## 5. UI/UX设计

### 5.1 页面结构

#### 5.1.1 整体布局

- **底部导航栏**：三个标签页（记录、历史、我的）
- **内容区域**：根据当前页面显示相应内容
- **弹窗**：用于表单录入和详情查看

#### 5.1.2 页面设计

1. **记录页**（/record）：
   - 周期信息卡片（开始时间、剩余时间、进度条、结束按钮）
   - 统计信息卡片（总排尿次数、总尿量、平均每次尿量、24小时总蛋白）
   - 排尿记录卡片（列表、添加按钮）
   - 检测结果卡片（显示结果、录入/编辑按钮）

2. **历史页**（/history）：
   - 时间筛选卡片（最近3个月、最近6个月、全部、查看图表按钮）
   - 历史记录列表（周期信息、删除按钮）

3. **我的页**（/profile）：
   - 个人信息卡片
   - 数据管理卡片（导出Excel、备份数据、恢复数据、清空所有数据）
   - 设置卡片（单位设置、主题设置）
   - 使用说明卡片
   - 关于卡片

### 5.2 交互设计

#### 5.2.1 操作流程

1. **开始检测周期**：
   - 点击"开始检测周期"按钮
   - 如果有上一个周期，显示确认弹窗
   - 创建新周期，显示周期信息

2. **记录排尿**：
   - 点击"添加记录"按钮
   - 弹出表单（时间、尿量）
   - 保存后更新列表和统计

3. **录入检测结果**：
   - 点击"录入"或"编辑"按钮
   - 弹出表单（各项检测指标）
   - 保存后显示结果（含异常值高亮）

4. **查看历史记录**：
   - 选择时间范围
   - 点击记录查看详情
   - 点击"查看图表"查看数据可视化

#### 5.2.2 反馈机制

- **成功操作**：Toast提示（绿色，成功图标）
- **失败操作**：Toast提示（红色，失败图标）
- **确认操作**：Dialog确认弹窗
- **加载状态**：Loading组件或按钮loading状态

### 5.3 视觉设计

#### 5.3.1 颜色方案

- **主色**：Ant Design Mobile默认蓝色
- **成功色**：绿色（#52c41a）
- **警告色**：橙色（#faad14）
- **错误色**：红色（#ff4d4f）
- **异常值**：红色高亮

#### 5.3.2 字体和间距

- 使用Ant Design Mobile默认字体和间距
- 标题：18px，加粗
- 正文：14px
- 辅助文字：12px，灰色
- 输入框字体：16px（防止iOS自动缩放）

#### 5.3.3 移动端优化

- **防止双击缩放**：使用`touch-action: manipulation`
- **安全区域适配**：使用CSS `env(safe-area-inset-*)`适配iPhone X等设备
- **点击区域优化**：按钮和链接最小尺寸44px×44px
- **滚动条样式**：自定义滚动条样式，提升视觉体验
- **响应式布局**：适配不同屏幕尺寸，使用媒体查询

## 6. 开发计划

### 6.1 开发阶段

#### 阶段一：基础功能（已完成）
- ✅ 项目初始化和环境搭建
- ✅ 数据库设计和实现
- ✅ 检测周期管理
- ✅ 排尿记录管理
- ✅ 检测结果录入

#### 阶段二：历史记录和数据管理（已完成）
- ✅ 历史记录查询
- ✅ 记录详情查看
- ✅ 数据导出（Excel）
- ✅ 数据备份和恢复

#### 阶段三：数据可视化和优化（已完成）
- ✅ 数据可视化图表
- ✅ 异常值判断和提示
- ✅ 用户设置
- ✅ UI优化和错误处理

### 6.2 未来规划

#### 功能扩展
- [ ] 支持多个用户（多账户）
- [ ] 数据云同步（可选）
- [ ] 提醒功能（推送通知）
- [ ] 数据统计分析（更多图表类型）
- [ ] 导出PDF报告

#### 技术优化
- [ ] PWA支持（离线使用）
- [ ] 性能优化（虚拟滚动、懒加载）
- [ ] 单元测试和集成测试
- [ ] 国际化支持（多语言）

## 7. 风险评估

### 7.1 技术风险

1. **浏览器兼容性**：
   - 风险：部分浏览器不支持IndexedDB或某些API
   - 应对：使用polyfill，提供降级方案

2. **数据丢失**：
   - 风险：浏览器数据被清除
   - 应对：提供数据备份功能，提示用户定期备份

3. **性能问题**：
   - 风险：数据量大时性能下降
   - 应对：优化查询，使用索引，分页加载

### 7.2 业务风险

1. **用户误操作**：
   - 风险：误删数据或误操作
   - 应对：关键操作需要确认，提供数据恢复功能

2. **数据准确性**：
   - 风险：用户输入错误数据
   - 应对：表单验证，提供正常值参考

### 7.3 用户接受度

1. **学习成本**：
   - 风险：用户不熟悉应用
   - 应对：提供使用说明，界面简洁直观

2. **使用习惯**：
   - 风险：用户习惯纸质记录
   - 应对：强调便捷性和数据管理优势

## 8. 附录

### 8.1 术语表

- **24小时尿蛋白检测**：连续24小时收集所有尿液进行检测的方法
- **检测周期**：从开始收集到结束的24小时时间段
- **排尿记录**：每次排尿的时间和尿量记录
- **检测结果**：实验室检测的各项指标
- **异常值**：超出正常值范围的检测指标

### 8.2 参考文档

- [React官方文档](https://react.dev/)
- [Ant Design Mobile文档](https://mobile.ant.design/)
- [Dexie.js文档](https://dexie.org/)
- [Chart.js文档](https://www.chartjs.org/)

### 8.3 版本历史

- **v1.0.0**（2024-01-01）：初始版本，实现所有核心功能
  - 检测周期管理（开始、结束、实时倒计时）
  - 排尿记录管理（添加、删除、查看）
  - 检测结果录入（含异常值判断）
  - 历史记录查询（列表、详情、删除）
  - 数据可视化（5种图表类型）
  - 数据管理（Excel导出、备份、恢复、清空）
  - 用户设置（个人信息、单位、主题）
  - 移动端优化（安全区域适配、防止双击缩放）
  - 错误处理（ErrorBoundary、Toast提示）

### 8.4 技术细节补充

#### 8.4.1 表单验证规则

**排尿记录表单**：
- 排尿时间：必填，Date类型
- 尿量：必填，>0，数字格式（支持小数），使用`inputMode="decimal"`

**检测结果表单**：
- 24H尿蛋白定量：必填，≥0，数字格式，使用`inputMode="decimal"`
- 肌酐：必填，≥0，数字格式，使用`inputMode="decimal"`
- 尿比重：必填，1.000-1.050，数字格式，步长0.001，使用`inputMode="decimal"`
- pH值：必填，0-14，数字格式，步长0.1，使用`inputMode="decimal"`
- 尿常规-尿蛋白/潜血：可选，从预设选项中选择（Selector组件）

**用户配置表单**：
- 昵称：必填，字符串
- 性别：可选，从预设选项中选择
- 年龄：可选，数字
- 单位设置：必填，从预设选项中选择
- 主题：必填，从预设选项中选择

#### 8.4.2 移动端适配细节

1. **安全区域适配**：
   ```css
   padding-top: max(16px, env(safe-area-inset-top));
   padding-bottom: max(80px, calc(env(safe-area-inset-bottom) + 80px));
   ```

2. **防止双击缩放**：
   ```css
   touch-action: manipulation;
   ```

3. **输入框优化**：
   ```css
   input, textarea {
     font-size: 16px; /* 防止iOS自动缩放 */
   }
   ```

4. **点击区域优化**：
   ```css
   button, a {
     min-height: 44px;
     min-width: 44px;
   }
   ```

#### 8.4.3 错误处理实现

1. **ErrorBoundary**：
   - 类组件实现，捕获子组件渲染错误
   - 显示友好错误页面，提供重试按钮
   - 错误信息记录到控制台

2. **异步错误处理**：
   - 所有数据库操作使用try-catch
   - 失败时显示Toast提示
   - 不影响其他功能正常使用

3. **表单验证错误**：
   - 使用Ant Design Mobile Form组件的rules属性
   - 支持必填验证、格式验证、自定义验证器
   - 实时反馈，清晰的错误提示

---

**文档版本**：1.0.0  
**最后更新**：2024-01-01  
**维护者**：开发团队
